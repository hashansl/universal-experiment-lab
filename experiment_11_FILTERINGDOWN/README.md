We have implemented the filtering up method correctly.

Simplest way to implement the filtering up method is to invert the weights by M-w. M is the maximum weight in the weights array. 

For example

A 10
B 5
C 2

The inverted weights are
A 0
B 5
C 8

Think about the filtration times. The filtration times are the times that the weights are inverted.